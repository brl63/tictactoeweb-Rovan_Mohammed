<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe Game</title>
    <style>
        :root { --primary: #007bff; --bg: #f0f2f5; --cell-size: 90px; }
        body { font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; background-color: var(--bg); margin: 0; padding: 20px; }
        .scoreboard { display: flex; gap: 20px; margin-bottom: 20px; background: white; padding: 15px 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .score-item { text-align: center; }
        .score-val { font-size: 24px; font-weight: bold; color: var(--primary); }
        .controls { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
        select { padding: 8px; border-radius: 5px; border: 1px solid #ccc; font-size: 14px; cursor: pointer; }
        .status { font-size: 20px; font-weight: bold; margin-bottom: 15px; color: #444; height: 30px; }
        .board { display: grid; grid-template-columns: repeat(3, var(--cell-size)); grid-gap: 8px; background-color: #bdc3c7; padding: 8px; border-radius: 12px; }
        .cell { width: var(--cell-size); height: var(--cell-size); background-color: white; display: flex; justify-content: center; align-items: center; font-size: 40px; font-weight: bold; cursor: pointer; border: none; border-radius: 8px; transition: all 0.2s; }
        .cell:hover { background-color: #f1f1f1; }
        .cell.win { background-color: #2ecc71; color: white !important; }
        .btn-group { margin-top: 25px; display: flex; gap: 10px; }
        .btn { padding: 10px 25px; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; }
        .restart-btn { background-color: var(--primary); color: white; }
        .reset-score { background-color: #e74c3c; color: white; }
    </style>
</head>
<body>

    <h1>Tic Tac Toe Game</h1>

    <div class="scoreboard">
        <div class="score-item"><div>X Player</div><div class="score-val" id="scoreX">0</div></div>
        <div class="score-item"><div>Draws</div><div class="score-val" id="scoreDraw">0</div></div>
        <div class="score-item"><div>O Player/AI</div><div class="score-val" id="scoreO">0</div></div>
    </div>
    
    <div class="controls">
        <select id="gameMode" onchange="resetBoardOnly()">
            <option value="pve">Vs Computer</option>
            <option value="pvp">Vs Player</option>
        </select>
        <select id="difficulty">
            <option value="hard">Hard (Minimax)</option>
            <option value="medium">Medium</option>
            <option value="easy">Easy</option>
        </select>
    </div>

    <div class="status" id="statusLabel">Turn: X</div>
    
    <div class="board" id="board">
        <button class="cell" onclick="handleCellClick(0)"></button>
        <button class="cell" onclick="handleCellClick(1)"></button>
        <button class="cell" onclick="handleCellClick(2)"></button>
        <button class="cell" onclick="handleCellClick(3)"></button>
        <button class="cell" onclick="handleCellClick(4)"></button>
        <button class="cell" onclick="handleCellClick(5)"></button>
        <button class="cell" onclick="handleCellClick(6)"></button>
        <button class="cell" onclick="handleCellClick(7)"></button>
        <button class="cell" onclick="handleCellClick(8)"></button>
    </div>

    <div class="btn-group">
        <button class="btn restart-btn" onclick="resetBoardOnly()">Next Round</button>
        <button class="btn reset-score" onclick="resetFullGame()">Reset Score</button>
    </div>

    <script>
        const PlayerX = "X";
        const PlayerO = "O";
        const Empty = "";
        
        let board = ["", "", "", "", "", "", "", "", ""];
        let turn = PlayerX;
        let active = true;
        let scores = { X: 0, O: 0, draw: 0 };

        const cells = document.querySelectorAll('.cell');
        const statusLbl = document.getElementById('statusLabel');
        const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

        function handleCellClick(i) {

            if (board[i] !== Empty || !active) return;
            if (getMode() === "pve" && turn === PlayerO) return;
            
            makeMove(i, turn);
            

            if (active && getMode() === "pve" && turn === PlayerO) {
                statusLbl.innerText = "AI is thinking...";
                setTimeout(aiTurn, 400);
            }
        }

        function makeMove(i, p) {
            board[i] = p;
            cells[i].innerText = p;
            cells[i].style.color = p === PlayerX ? "#2980b9" : "#c0392b";
            checkGameState();
        }

        function aiTurn() {
            if (!active) return;
            const diff = document.getElementById('difficulty').value;
            let move;

            if (diff === "easy") move = getRandomMove();
            else if (diff === "medium") move = getMediumMove() || getRandomMove();
            else move = getBestMove();

            if (move !== null) makeMove(move, PlayerO);
        }

        function getRandomMove() {
            let available = board.map((v, i) => v === Empty ? i : null).filter(v => v !== null);
            return available[Math.floor(Math.random() * available.length)];
        }

        function getMediumMove() {
            for (let p of [PlayerO, PlayerX]) {
                for (let combo of wins) {
                    let vals = combo.map(i => board[i]);
                    if (vals.filter(v => v === p).length === 2 && vals.filter(v => v === Empty).length === 1) {
                        return combo[vals.indexOf(Empty)];
                    }
                }
            }
            return null;
        }

        function getBestMove() {
            let bestScore = -Infinity;
            let move = null;
            for (let i = 0; i < 9; i++) {
                if (board[i] === Empty) {
                    board[i] = PlayerO;
                    let score = minimax(board, 0, false);
                    board[i] = Empty;
                    if (score > bestScore) {
                        bestScore = score;
                        move = i;
                    }
                }
            }
            return move;
        }

        function minimax(b, depth, isMaximizing) {
            let res = evaluate();
            if (res !== null) return res === 'O' ? 10 - depth : res === 'X' ? depth - 10 : 0;

            if (isMaximizing) {
                let best = -Infinity;
                for (let i = 0; i < 9; i++) {
                    if (b[i] === Empty) {
                        b[i] = PlayerO;
                        best = Math.max(best, minimax(b, depth + 1, false));
                        b[i] = Empty;
                    }
                }
                return best;
            } else {
                let best = Infinity;
                for (let i = 0; i < 9; i++) {
                    if (b[i] === Empty) {
                        b[i] = PlayerX;
                        best = Math.min(best, minimax(b, depth + 1, true));
                        b[i] = Empty;
                    }
                }
                return best;
            }
        }

        function evaluate() {
            for (let c of wins) {
                if (board[c[0]] && board[c[0]] === board[c[1]] && board[c[0]] === board[c[2]]) return board[c[0]];
            }
            return board.includes(Empty) ? null : 'draw';
        }

        function checkGameState() {
            let winner = evaluate();
            if (winner) {
                active = false;
                if (winner === 'draw') {
                    statusLbl.innerText = "It's a Draw!";
                    scores.draw++;
                } else {
                    highlightWin();
                    statusLbl.innerText = `Winner: ${winner}`;
                    winner === PlayerX ? scores.X++ : scores.O++;
                }
                updateScoreboard();
                return;
            }

            turn = (turn === PlayerX) ? PlayerO : PlayerX;
            statusLbl.innerText = `Turn: ${turn}`;
        }

        function highlightWin() {
            for (let c of wins) {
                if (board[c[0]] && board[c[0]] === board[c[1]] && board[c[0]] === board[c[2]]) {
                    c.forEach(i => cells[i].classList.add('win'));
                }
            }
        }

        function updateScoreboard() {
            document.getElementById('scoreX').innerText = scores.X;
            document.getElementById('scoreO').innerText = scores.O;
            document.getElementById('scoreDraw').innerText = scores.draw;
        }

        function getMode() { return document.getElementById('gameMode').value; }

        function resetBoardOnly() {
            board = ["", "", "", "", "", "", "", "", ""];
            turn = PlayerX;
            active = true;
            statusLbl.innerText = "Turn: X";
            cells.forEach(c => { c.innerText = ""; c.classList.remove('win'); });
        }

        function resetFullGame() {
            scores = { X: 0, O: 0, draw: 0 };
            updateScoreboard();
            resetBoardOnly();
        }
    </script>
</body>
</html>